<html>
<head>
<title>TestController.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.ln { color: rgb(0,0,0); font-weight: normal; font-style: normal; }
.s0 { color: rgb(128,128,128); font-style: italic; }
.s1 { color: rgb(128,128,128); font-weight: bold; font-style: italic; }
.s2 { }
.s3 { color: rgb(0,0,128); font-weight: bold; }
.s4 { color: rgb(0,128,0); font-weight: bold; }
</style>
</head>
<BODY BGCOLOR="#ffffff">
<TABLE CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#C0C0C0" >
<TR><TD><CENTER>
<FONT FACE="Arial, Helvetica" COLOR="#000000">
TestController.js</FONT>
</center></TD></TR></TABLE>
<pre>

<span class="s0">/** 
 * TestController 
 * 
 * </span><span class="s1">@description </span><span class="s0">:: Server-side logic for managing tests 
 * </span><span class="s1">@help        </span><span class="s0">:: See http://sailsjs.org/#!/documentation/concepts/Controllerssd 
 */</span><span class="s2"> 
 
module.exports = { 
  </span><span class="s0">//____________________________________________debut fonctionn FIND</span><span class="s2"> 
  findTest: </span><span class="s3">function</span><span class="s2">(req, res) 
  { 
    </span><span class="s3">if </span><span class="s2">(!req.session.user) </span><span class="s3">return </span><span class="s2">res.redirect(</span><span class="s4">'/login'</span><span class="s2">); 
 
    Test.query(</span><span class="s4">'select fr_test.*, fr_type_test.nom_type_test from fr_test join fr_type_test on fr_test.id_type_test = fr_type_test.id_type_test where fr_type_test.id_type_test &lt; 4 and fr_test.suppr = false'</span><span class="s2">, </span><span class="s3">function</span><span class="s2">(err, found) </span><span class="s0">//atao requette sql</span><span class="s2"> 
    { 
      </span><span class="s3">if</span><span class="s2">(err) 
      { 
        console.log(err); 
      } 
      console.log(found); 
      res.view( </span><span class="s4">'test/listeTest'</span><span class="s2">, {tests: found.rows} ); 
    }); 
  }, 
  findTestT: </span><span class="s3">function</span><span class="s2">(req, res) 
  { 
    </span><span class="s3">if </span><span class="s2">(!req.session.user) </span><span class="s3">return </span><span class="s2">res.redirect(</span><span class="s4">'/login'</span><span class="s2">); 
 
    Test.query(</span><span class="s4">'select fr_test.*, fr_type_test.nom_type_test from fr_test join fr_type_test on fr_test.id_type_test = fr_type_test.id_type_test where fr_type_test.id_type_test &lt; 4 and fr_test.suppr = false'</span><span class="s2">, </span><span class="s3">function</span><span class="s2">(err, found) </span><span class="s0">//atao requette sql</span><span class="s2"> 
    { 
      </span><span class="s3">if</span><span class="s2">(err) 
      { 
        console.log(err); 
      } 
      console.log(found); 
      res.view( </span><span class="s4">'testeur/listeTestTesteur'</span><span class="s2">, {tests: found.rows} ); 
    }); 
  }, 
  </span><span class="s0">//____________________________________________fin fonctionn FIND</span><span class="s2"> 
 
 
  </span><span class="s0">//____________________________________________debut fonctionn FIND test dpecifique</span><span class="s2"> 
  findTestSpecifique: </span><span class="s3">function</span><span class="s2">(req, res) 
  { 
    </span><span class="s3">if </span><span class="s2">(!req.session.user) </span><span class="s3">return </span><span class="s2">res.redirect(</span><span class="s4">'/login'</span><span class="s2">); 
 
    Test.query(</span><span class="s4">'select fr_test.*, fr_type_test.nom_type_test from fr_test join fr_type_test on fr_test.id_type_test = fr_type_test.id_type_test where fr_type_test.id_type_test = 4 and fr_test.suppr = false'</span><span class="s2">, </span><span class="s3">function</span><span class="s2">(err, found) </span><span class="s0">//atao requette sql</span><span class="s2"> 
    { 
      </span><span class="s3">if</span><span class="s2">(err) 
      { 
        console.log(err); 
      } 
      console.log(found); 
      res.view( </span><span class="s4">'test/listeTestSpecifique'</span><span class="s2">, {tests: found.rows} ); 
    }); 
  }, 
  findTestSpecifiqueT: </span><span class="s3">function</span><span class="s2">(req, res) 
  { 
    </span><span class="s3">if </span><span class="s2">(!req.session.user) </span><span class="s3">return </span><span class="s2">res.redirect(</span><span class="s4">'/login'</span><span class="s2">); 
 
    Test.query(</span><span class="s4">'select fr_test.*, fr_type_test.nom_type_test from fr_test join fr_type_test on fr_test.id_type_test = fr_type_test.id_type_test where fr_type_test.id_type_test = 4 and fr_test.suppr = false'</span><span class="s2">, </span><span class="s3">function</span><span class="s2">(err, found) </span><span class="s0">//atao requette sql</span><span class="s2"> 
    { 
      </span><span class="s3">if</span><span class="s2">(err) 
      { 
        console.log(err); 
      } 
      console.log(found); 
      res.view( </span><span class="s4">'testeur/listeTestSpecifiqueTesteur'</span><span class="s2">, {tests: found.rows} ); 
    }); 
  }, 
  </span><span class="s0">//____________________________________________fin fonctionn FIND</span><span class="s2"> 
 
 
  </span><span class="s0">//____________________________________________debut fonctionn FIND BY ID</span><span class="s2"> 
  </span><span class="s0">//fonction qui recherche un test par son id et qui retourne un test</span><span class="s2"> 
  findTestById: </span><span class="s3">function</span><span class="s2">(req, res) 
  { 
    </span><span class="s3">if </span><span class="s2">(!req.session.user) </span><span class="s3">return </span><span class="s2">res.redirect(</span><span class="s4">'/login'</span><span class="s2">); 
 
    </span><span class="s3">var </span><span class="s2">id=req.param(</span><span class="s4">'id'</span><span class="s2">,</span><span class="s3">null</span><span class="s2">); </span><span class="s0">//id application</span><span class="s2"> 
    Test.findOne(id).exec(</span><span class="s3">function </span><span class="s2">(err, finn) 
    { 
      </span><span class="s3">if </span><span class="s2">(err) 
      { 
        </span><span class="s3">return </span><span class="s2">res.negotiate(err); 
      } 
      </span><span class="s3">if </span><span class="s2">(!id) 
      { 
        </span><span class="s3">return </span><span class="s2">res.notFound(</span><span class="s4">'Could not find sorry.'</span><span class="s2">); 
      } 
      </span><span class="s0">//Redirection ver detailApplication avec la liste des applications, liste des tests, liste des tests spÃ©cifiques de l'application</span><span class="s2"> 
      res.view( </span><span class="s4">'test/modifierTest'</span><span class="s2">, {tests: finn} ); 
 
    }); 
  }, 
  </span><span class="s0">//____________________________________________fin fonctionn FIND BY ID</span><span class="s2"> 
 
 
  </span><span class="s0">//____________________________________________debut fonctionn FIND BY ID (Test specifique)</span><span class="s2"> 
  </span><span class="s0">//fonction qui recherche un test par son id et qui retourne un test</span><span class="s2"> 
  findTestSpecById: </span><span class="s3">function</span><span class="s2">(req, res) 
  { 
    </span><span class="s3">if </span><span class="s2">(!req.session.user) </span><span class="s3">return </span><span class="s2">res.redirect(</span><span class="s4">'/login'</span><span class="s2">); 
 
    </span><span class="s3">var </span><span class="s2">id=req.param(</span><span class="s4">'id'</span><span class="s2">,</span><span class="s3">null</span><span class="s2">); </span><span class="s0">//id application</span><span class="s2"> 
    Test.findOne(id).exec(</span><span class="s3">function </span><span class="s2">(err, finn) 
    { 
      </span><span class="s3">if </span><span class="s2">(err) 
      { 
        </span><span class="s3">return </span><span class="s2">res.negotiate(err); 
      } 
      </span><span class="s3">if </span><span class="s2">(!id) 
      { 
        </span><span class="s3">return </span><span class="s2">res.notFound(</span><span class="s4">'Could not find sorry.'</span><span class="s2">); 
      } 
      </span><span class="s0">//Redirection ver detailApplication avec la liste des applications, liste des tests, liste des tests spÃ©cifiques de l'application</span><span class="s2"> 
      res.view( </span><span class="s4">'test/modifierTestSpecifique'</span><span class="s2">, {tests: finn} ); 
 
    }); 
  }, 
  </span><span class="s0">//____________________________________________fin fonctionn FIND BY ID</span><span class="s2"> 
 
  </span><span class="s0">//____________________________________________debut fonctionn CREATE</span><span class="s2"> 
  createTest: </span><span class="s3">function </span><span class="s2">(req, res) 
  { 
      </span><span class="s3">if </span><span class="s2">(!req.session.user) </span><span class="s3">return </span><span class="s2">res.redirect(</span><span class="s4">'/login'</span><span class="s2">); 
 
      Test.create({nom_test:req.param(</span><span class="s4">'nomTest'</span><span class="s2">),id_type_test:req.param(</span><span class="s4">'typeTest'</span><span class="s2">), id_etape:req.param(</span><span class="s4">'etapeTest'</span><span class="s2">)}).exec(</span><span class="s3">function</span><span class="s2">(err,model) 
      { 
        </span><span class="s3">if </span><span class="s2">(err) { 
 
          console.log(err); 
        } 
        </span><span class="s3">else</span><span class="s2"> 
        { 
          </span><span class="s0">//res.send('Successfully Created!');</span><span class="s2"> 
          res.redirect(</span><span class="s4">'/listeTest'</span><span class="s2">); 
        } 
 
      }); 
  }, 
  </span><span class="s0">//____________________________________________fin fonction CREATE</span><span class="s2"> 
 
  </span><span class="s0">//____________________________________________debut fonctionn ajout test ====&gt; vers page ajout test commun</span><span class="s2"> 
  ajoutTest: </span><span class="s3">function </span><span class="s2">(req, res) 
  { 
    </span><span class="s3">if </span><span class="s2">(!req.session.user) </span><span class="s3">return </span><span class="s2">res.redirect(</span><span class="s4">'/login'</span><span class="s2">); 
 
    Etape.query(</span><span class="s4">'select id_lien, p_etape.libelle from p_lien_oper_dossier LEFT JOIN p_etape ON p_lien_oper_dossier.id_oper=p_etape.id_etape order by id_lien'</span><span class="s2">, </span><span class="s3">function</span><span class="s2">(eror, etape) 
    { 
      </span><span class="s3">if </span><span class="s2">(eror) 
      { 
        </span><span class="s3">return </span><span class="s2">res.send(</span><span class="s4">'erreur 2018'</span><span class="s2">); 
      }</span><span class="s3">else</span><span class="s2">{ 
        res.view( </span><span class="s4">'test/ajoutTestCommun'</span><span class="s2">, {etapes: etape.rows}); 
      } 
    }); 
  }, 
  </span><span class="s0">//____________________________________________fin fonction ajout test</span><span class="s2"> 
 
 
  </span><span class="s0">//____________________________________________debut fonctionn CREATE SPECIFIQUE</span><span class="s2"> 
  </span><span class="s0">//fonction pour ajouter un test spÃ©cifique Ã  une application</span><span class="s2"> 
  createTestSpec: </span><span class="s3">function </span><span class="s2">(req, res) 
  { 
    </span><span class="s3">if </span><span class="s2">(!req.session.user) </span><span class="s3">return </span><span class="s2">res.redirect(</span><span class="s4">'/login'</span><span class="s2">); 
 
    </span><span class="s3">var </span><span class="s2">nomTest = req.param(</span><span class="s4">'nomTest'</span><span class="s2">); 
    </span><span class="s3">var </span><span class="s2">typeTest = req.param(</span><span class="s4">'typeTest'</span><span class="s2">); 
    Test.create({nom_test:nomTest,id_type_test:typeTest,id_etape:req.param(</span><span class="s4">'etapeTest'</span><span class="s2">)}).exec(</span><span class="s3">function</span><span class="s2">(err,model) 
    { 
      </span><span class="s3">if </span><span class="s2">(err) { 
        console.log(err); 
      } 
      </span><span class="s3">else</span><span class="s2"> 
      { 
        console.log(</span><span class="s4">&quot;create&quot;</span><span class="s2">+model); 
        Test.findOne({nom_test: nomTest, id_type_test:typeTest}).exec(</span><span class="s3">function</span><span class="s2">(err, found) 
        { 
          </span><span class="s3">if</span><span class="s2">(err) 
          { 
            console.log(err); 
          } 
          </span><span class="s3">else</span><span class="s2"> 
          { 
            console.log(found); 
            </span><span class="s3">var </span><span class="s2">resultat = </span><span class="s3">null</span><span class="s2">; 
            TestApp.create({id_test:found.id_test, id_application:req.param(</span><span class="s4">'idApplication'</span><span class="s2">), id_resultat:resultat}).exec(</span><span class="s3">function</span><span class="s2">(err,model) 
            { 
              </span><span class="s3">if </span><span class="s2">(err) { 
                console.log(err); 
              } 
              </span><span class="s3">else</span><span class="s2"> 
              { 
                res.redirect(</span><span class="s4">'/appById?id='</span><span class="s2">+req.param(</span><span class="s4">'idApplication'</span><span class="s2">)); 
              } 
            }); 
          } 
        }); 
      } 
    }); 
  }, 
  </span><span class="s0">//____________________________________________fin fonction CREATE spec</span><span class="s2"> 
 
 
  </span><span class="s0">//____________________________________________debut fonctionn UPDATE</span><span class="s2"> 
  updateTest: </span><span class="s3">function </span><span class="s2">(req, res) 
  { 
    </span><span class="s3">if </span><span class="s2">(!req.session.user) </span><span class="s3">return </span><span class="s2">res.redirect(</span><span class="s4">'/login'</span><span class="s2">); 
 
    </span><span class="s3">var </span><span class="s2">params = req.params.all(); 
    </span><span class="s3">var </span><span class="s2">id = params.id_test; 
 
    Test.update({id_test: id}, params).exec(</span><span class="s3">function </span><span class="s2">(err, model) { 
      </span><span class="s3">if </span><span class="s2">(err) res.send(</span><span class="s4">&quot;Error:&quot;</span><span class="s2">.err); 
      </span><span class="s3">else return </span><span class="s2">res.redirect(</span><span class="s4">'listeTest'</span><span class="s2">); 
    }); 
  }, 
  </span><span class="s0">//____________________________________________fin fonctionn UPDATE</span><span class="s2"> 
 
  </span><span class="s0">//____________________________________________debut fonctionn UPDATE test specifique</span><span class="s2"> 
  updateTestSpec: </span><span class="s3">function </span><span class="s2">(req, res) 
  { 
    </span><span class="s3">if </span><span class="s2">(!req.session.user) </span><span class="s3">return </span><span class="s2">res.redirect(</span><span class="s4">'/login'</span><span class="s2">); 
 
    </span><span class="s3">var </span><span class="s2">params = req.params.all(); 
    </span><span class="s3">var </span><span class="s2">id = params.id_test; 
 
    Test.update({id_test: id}, params).exec(</span><span class="s3">function </span><span class="s2">(err, model) { 
      </span><span class="s3">if </span><span class="s2">(err) res.send(</span><span class="s4">&quot;Error:&quot;</span><span class="s2">.err); 
      </span><span class="s3">else return </span><span class="s2">res.redirect(</span><span class="s4">'listeTestSpecifique'</span><span class="s2">); 
    }); 
  }, 
  </span><span class="s0">//____________________________________________fin fonctionn UPDATE</span><span class="s2"> 
 
  deleteTest: </span><span class="s3">function </span><span class="s2">(req, res) 
  { 
    </span><span class="s3">if </span><span class="s2">(!req.session.user) </span><span class="s3">return </span><span class="s2">res.redirect(</span><span class="s4">'/login'</span><span class="s2">); 
 
    </span><span class="s3">var </span><span class="s2">id = req.param(</span><span class="s4">'idTest'</span><span class="s2">); 
    console.log(</span><span class="s4">&quot;_______________________________________________________tonga eto   &quot;</span><span class="s2">+id); 
    Test.update({id_test: id},{suppr:</span><span class="s4">'true'</span><span class="s2">}).exec(</span><span class="s3">function </span><span class="s2">(err, updated){ 
      </span><span class="s3">if </span><span class="s2">(err) { 
        console.log(err); 
        </span><span class="s3">return</span><span class="s2">; 
      } 
      </span><span class="s3">else return </span><span class="s2">res.redirect(</span><span class="s4">'listeTest'</span><span class="s2">); 
    }); 
  }, 
 
}; 
 
</span></pre>
</body>
</html>